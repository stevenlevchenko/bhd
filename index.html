<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Blackhawk Data â€“ Office Dashboard (Channel Live Streams)</title>
<link rel="preconnect" href="https://www.youtube.com" />
<link rel="preconnect" href="https://www.youtube-nocookie.com" />
<link rel="preconnect" href="https://i.ytimg.com" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0a0f1a;--card:#0f1726;--muted:#7d8aa5;--accent:#1e90ff;--border:#1b2440;
    --text:#e6eefc;--chip:#0b1627;--chipb:#1f2a3d;--good:#5bd37f;--warn:#ffcc66;--bad:#ff6b6b;
    --radius:16px;
  }
  body[data-theme="light"]{
    --bg:#f7f9fc;--card:#ffffff;--muted:#5a6b85;--accent:#1068d6;--border:#dfe6f2;
    --text:#0e1726;--chip:#eef3fb;--chipb:#d3def0;--good:#1f9e4a;--warn:#b88300;--bad:#d12f2f;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
       background:radial-gradient(1100px 800px at 80% -10%,rgba(30,144,255,.08),transparent 60%),var(--bg)}
  a{color:var(--accent);text-decoration:none}
  header{position:sticky;top:0;z-index:40;backdrop-filter:blur(8px);
         background:linear-gradient(180deg,rgba(10,15,26,.9),rgba(10,15,26,.6));
         border-bottom:1px solid var(--border)}
  body[data-theme="light"] header{background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.7))}
  .bar{max-width:1600px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;gap:16px}
  .logo{height:36px;width:auto}
  .grow{flex:1}
  .clock{font-variant-numeric:tabular-nums;letter-spacing:1px;font-weight:700;padding:6px 12px;border:1px solid var(--border);
         border-radius:999px;background:#0b1624}
  body[data-theme="light"] .clock{background:#edf3ff}
  .themebtn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);background:transparent;color:var(--text);
            padding:6px 10px;border-radius:999px;cursor:pointer;font-size:12px}
  .themebtn:hover{border-color:#2a3a6b}
  main{max-width:1600px;margin:20px auto;padding:0 18px 28px}
  .grid{display:grid;gap:18px;grid-template-columns:repeat(12,1fr);grid-auto-rows:minmax(160px,auto)}
  .tile{grid-column:span 12;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
        overflow:hidden;box-shadow:0 8px 28px rgba(0,0,0,.15);display:flex;flex-direction:column}
  .tile h2{margin:0;padding:12px 14px;font-size:16px;font-weight:700;letter-spacing:.3px;border-bottom:1px solid var(--border);
           background:linear-gradient(180deg,rgba(255,255,255,.02),transparent)}
  body[data-theme="light"] .tile{box-shadow:0 8px 28px rgba(10,30,60,.06)}
  .tile .content{padding:12px}
  .muted{color:var(--muted)}
  .cams-grid{display:grid;gap:14px;grid-template-columns:repeat(12,1fr)}
  .cam{grid-column:span 12;border:1px solid var(--border);border-radius:14px;overflow:hidden;background:#0c131c;display:flex;flex-direction:column}
  body[data-theme="light"] .cam{background:#ffffff}
  @media (min-width:700px){.cam{grid-column:span 6}}
  @media (min-width:1200px){.cam{grid-column:span 4}}
  .media{position:relative;width:100%;padding-top:56.25%;background:#000}
  .media iframe{position:absolute;inset:0;width:100%;height:100%;border:0;display:block}
  .meta{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;background:#0b1624;border-top:1px solid var(--border)}
  body[data-theme="light"] .meta{background:#f5f8ff}
  .name{font-weight:700;font-size:14px}
  .city{font-size:12px;color:#a0b2cf}
  body[data-theme="light"] .city{color:#456088}
  .actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .tiny{font-size:11px;padding:4px 8px;border-radius:8px;border:1px solid var(--border);background:#0c1428;color:var(--text);cursor:pointer}
  body[data-theme="light"] .tiny{background:#eef3ff;color:#0e1726}
</style>
</head>
<body>
  <header>
    <div class="bar">
      <img class="logo" alt="Blackhawk Data" src="https://blackhawk11.com/wp-content/uploads/2024/12/new-blue-bhd-horizontal-black-blue.png" />
      <div class="grow"></div>
      <button id="themeBtn" class="themebtn" type="button" aria-label="Toggle color theme">
        <span id="themeIcon">ðŸŒ™</span><span id="themeText">Dark</span>
      </button>
      <div id="clock" class="clock" aria-live="polite" style="margin-left:8px">--:--:-- ET</div>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="tile" id="engineer-cams">
        <h2>Engineer Weather Cams â€“ Channel Autoplay</h2>
        <div class="content">
          <div class="cams-grid" id="camsGrid"></div>
          <p class="muted" style="margin-top:10px">Muted for autoplay. Click a tile if your browser blocks autoplay.</p>
        </div>
      </section>
    </div>
  </main>

<script>
  // Theme toggle
  const themeBtn = document.getElementById('themeBtn');
  const themeIcon = document.getElementById('themeIcon');
  const themeText = document.getElementById('themeText');
  function applyTheme(t){
    document.body.setAttribute('data-theme', t);
    if(t === 'light'){ themeIcon.textContent='â˜€ï¸'; themeText.textContent='Light'; }
    else { themeIcon.textContent='ðŸŒ™'; themeText.textContent='Dark'; }
    localStorage.setItem('bh-theme', t);
  }
  (function initTheme(){
    const saved = localStorage.getItem('bh-theme');
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(saved || (prefersDark ? 'dark':'light'));
  })();
  themeBtn.addEventListener('click', ()=>{
    const cur = document.body.getAttribute('data-theme') || 'dark';
    applyTheme(cur === 'dark' ? 'light' : 'dark');
  });

  // Clock
  const clockEl = document.getElementById('clock');
  function tick(){
    try{
      const now = new Date();
      const s = new Intl.DateTimeFormat('en-US',{timeZone:'America/New_York',hour12:false,timeStyle:'medium'}).format(now);
      clockEl.textContent = s + ' ET';
    }catch{ clockEl.textContent = new Date().toLocaleTimeString() + ' ET'; }
    requestAnimationFrame(()=>setTimeout(tick,500));
  }
  tick();

  // ---- YouTube autoplay manager ----
  const players = [];
  const channelIframes = [];
  function ytIdFromUrl(u){
    try{
      const url = new URL(u);
      if(url.hostname.includes('youtube') || url.hostname.includes('youtu.be')){
        if(url.pathname.startsWith('/watch')) return url.searchParams.get('v');
        const m = url.pathname.match(/\/embed\/([A-Za-z0-9_\-]+)/); if(m) return m[1];
        if(url.hostname==='youtu.be'){ return url.pathname.slice(1); }
        const s = url.searchParams.get('v'); if(s) return s;
      }
    }catch{}
    return null;
  }

  window.onYouTubeIframeAPIReady = function(){ startAll(); };
  (function(){ const s=document.createElement('script'); s.src='https://www.youtube.com/iframe_api'; s.async=true; document.head.appendChild(s); })();

  function buildVideoPlayer(el, videoId, useNoCookie=false){
    const host = useNoCookie ? 'https://www.youtube-nocookie.com' : 'https://www.youtube.com';
    const p = new YT.Player(el, {
      host,
      videoId,
      playerVars: { autoplay:1, mute:1, playsinline:1, rel:0, controls:1, modestbranding:1, fs:1, iv_load_policy:3 },
      events: {
        onReady: (e)=>{ try{ e.target.mute(); e.target.playVideo(); }catch{} },
        onStateChange: (e)=>{
          if(e.data === YT.PlayerState.UNSTARTED || e.data === YT.PlayerState.PAUSED){
            try{ e.target.playVideo(); }catch{}
          }
        },
        onError: ()=>{
          try{
            const parent = p.getIframe().parentElement;
            parent.innerHTML=''; const div=document.createElement('div'); parent.appendChild(div);
            setTimeout(()=>buildVideoPlayer(div, videoId, !useNoCookie), 50);
          }catch{}
        }
      }
    });
    players.push(p);
    setTimeout(()=>{ try{ p.mute(); p.playVideo(); }catch{} }, 400);
    setInterval(()=>{ try{ if(p.getPlayerState && p.getPlayerState() !== YT.PlayerState.PLAYING){ p.playVideo(); } }catch{} }, 5000);
  }

  function buildChannelIframe(slot, channelId, useNoCookie=false){
    const host = useNoCookie ? 'https://www.youtube-nocookie.com' : 'https://www.youtube.com';
    const ifr = document.createElement('iframe');
    ifr.setAttribute('allow', 'autoplay; encrypted-media; picture-in-picture');
    ifr.setAttribute('allowfullscreen', '');
    ifr.setAttribute('referrerpolicy', 'no-referrer-when-downgrade');
    ifr.setAttribute('loading', 'eager');
    ifr.src = `${host}/embed/live_stream?channel=${encodeURIComponent(channelId)}&autoplay=1&mute=1&playsinline=1&rel=0&modestbranding=1`;
    ifr.style.cssText = 'position:absolute;inset:0;width:100%;height:100%;border:0;display:block';
    slot.innerHTML = ''; slot.appendChild(ifr);
    const entry = { iframe: ifr, channelId, useNoCookie };
    channelIframes.push(entry);
    const nudge = ()=>{
      try{
        ifr.contentWindow?.postMessage(JSON.stringify({event:'command',func:'mute',args:[]}), '*');
        ifr.contentWindow?.postMessage(JSON.stringify({event:'command',func:'playVideo',args:[]}), '*');
      }catch{}
    };
    setTimeout(nudge, 250);
    const interval = setInterval(nudge, 4000);
    setTimeout(()=>{ clearInterval(interval); if(!entry.useNoCookie){ buildChannelIframe(slot, channelId, true); } }, 15000);
  }

  function startAll(){
    players.forEach(p=>{ try{ p.mute(); p.playVideo(); }catch{} });
    channelIframes.forEach(({iframe})=>{
      try{
        iframe.contentWindow?.postMessage(JSON.stringify({event:'command',func:'mute',args:[]}), '*');
        iframe.contentWindow?.postMessage(JSON.stringify({event:'command',func:'playVideo',args:[]}), '*');
      }catch{}
    });
  }
  ['click','keydown','touchstart'].forEach(ev=>{ window.addEventListener(ev, startAll, { passive:true }); });
  document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='visible') startAll(); });

  // ---- Cameras (channel-first) ----
  const cams = [
    { who:'Rafael Caballero', kind:'youtube', url:'https://www.youtube.com/watch?v=xR8_Es3pMss', city:'Roanoke (near Winchester)', state:'VA' },

    // Lauren -> ABC13 Houston channel live
    { who:'Lauren Gonzalez', kind:'youtube', ytChannel:'UCDmNmxF3ZVMeGyvWE9tOqPQ', url:'https://www.youtube.com/@ABC13Houston/live', city:'Houston', state:'TX' },

    { who:'Joe Golemb', kind:'youtube', url:'https://www.youtube.com/watch?v=ATbtGvbExP4', city:'Nashville', state:'TN' },

    // Nathan -> Aaron Preslin / CincyVision channel live
    { who:'Nathan Brann', kind:'youtube', ytChannel:'UCQc7Ol2itgbnMXPjZmPdRRQ', url:'https://www.youtube.com/@AaronPreslin/live', city:'Cincinnati', state:'OH' },

    // Noah -> WFMY News 2 channel live
    { who:'Noah Herald', kind:'youtube', ytChannel:'UC6UcjqhROKEWmz7aGzees9A', url:'https://www.youtube.com/@wfmynews2/live', city:'Greensboro (Triad)', state:'NC' },

    // Jake -> Peregrine Networks channel live (Manchester, NH)
    { who:'Jake Fitzgerald', kind:'youtube', ytChannel:'UCWqiOqqcBZT9Rx3HX7Zrd6A', url:'https://www.youtube.com/@peregrinenetworks5080/live', city:'Manchester / NH region', state:'NH' },

    { who:'Steve Luton', kind:'youtube', url:'https://www.youtube.com/watch?v=E_VpviMTH9k', city:'Denver', state:'CO' }
  ];

  const grid = document.getElementById('camsGrid');

  function addYouTubeCard(cfg){
    const card = document.createElement('article'); card.className='cam';
    const wrap = document.createElement('div'); wrap.className='media'; card.appendChild(wrap);

    const actions = document.createElement('div'); actions.className='actions';

    if(cfg.ytChannel){
      const slot = document.createElement('div'); slot.style.cssText='position:absolute;inset:0';
      wrap.appendChild(slot);
      buildChannelIframe(slot, cfg.ytChannel, false);

      const openSrc = document.createElement('a'); openSrc.className='tiny'; openSrc.target='_blank'; openSrc.rel='noopener';
      openSrc.href = `https://www.youtube.com/channel/${encodeURIComponent(cfg.ytChannel)}/live`;
      openSrc.textContent = 'Open channel live';
      const kick = document.createElement('button'); kick.className='tiny'; kick.textContent='Play / Retry';
      kick.addEventListener('click', startAll);
      actions.append(openSrc, kick);
    }else{
      const div = document.createElement('div'); div.id = 'yt_'+Math.random().toString(36).slice(2);
      div.style.cssText='position:absolute;inset:0';
      wrap.appendChild(div);
      const id = ytIdFromUrl(cfg.url);
      const build = ()=>{
        if(window.YT && window.YT.Player){ buildVideoPlayer(div, id, false); }
        else { setTimeout(build, 120); }
      };
      build();

      const openSrc = document.createElement('a'); openSrc.className='tiny'; openSrc.target='_blank'; openSrc.rel='noopener';
      openSrc.href = `https://www.youtube.com/watch?v=${id}`;
      openSrc.textContent = 'Open source';
      const kick = document.createElement('button'); kick.className='tiny'; kick.textContent='Play / Retry';
      kick.addEventListener('click', startAll);
      actions.append(openSrc, kick);
    }

    const meta = document.createElement('div'); meta.className='meta';
    const right = document.createElement('div'); right.className='actions'; right.append(...actions.children);
    meta.innerHTML = `<div><div class="name">${cfg.who}</div><div class="city">${cfg.city}, ${cfg.state}</div></div>`;
    meta.appendChild(right);
    card.appendChild(meta);
    grid.appendChild(card);
  }

  cams.forEach(c=> addYouTubeCard(c));

  if(window.YT && typeof YT.Player === 'function'){ startAll(); }
</script>
</body>
</html>
